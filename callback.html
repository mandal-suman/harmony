<!DOCTYPE html>
<html>

<head>
    <title>Spotify Auth Callback</title>
    <script>
        window.addEventListener('DOMContentLoaded', () => {
            try {
                // Extract the hash parameters
                const hash = window.location.hash.substring(1);
                const params = new URLSearchParams(hash);

                const accessToken = params.get('access_token');
                const expiresIn = params.get('expires_in');
                const error = params.get('error');

                if (error) {
                    // Send error message back to main window
                    window.opener.postMessage({
                        type: 'SPOTIFY_AUTH_ERROR',
                        error: error,
                        errorDescription: params.get('error_description')
                    }, 'https://mandal-suman.github.io');
                } else if (accessToken) {
                    // Send success message back to main window
                    window.opener.postMessage({
                        type: 'SPOTIFY_AUTH_SUCCESS',
                        accessToken: accessToken,
                        expiresIn: expiresIn || 3600
                    }, 'https://mandal-suman.github.io');
                }

                // Close this popup
                window.close();
            } catch (err) {
                console.error('Error in callback:', err);
                window.opener.postMessage({
                    type: 'SPOTIFY_AUTH_ERROR',
                    error: 'callback_error',
                    errorDescription: err.message
                }, 'https://mandal-suman.github.io');
                window.close();
            }
        });
    </script>
</head>

<body>
    <p>Completing authentication... You can close this window if it doesn't close automatically.</p>
</body>

</html>